<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

	<head>
	
		<meta charset="UTF-8">
		<title>Departments Table</title>
		
		<!-- Icon Font Stylesheet -->
	    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
	    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
	
	    <!-- Libraries Stylesheet -->
	    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
	    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
	
	    <!-- Customized Bootstrap Stylesheet -->
	    <link href="css/bootstrap.min.css" rel="stylesheet">
	
	    <!-- Template Stylesheet -->
	    <link href="css/style.css" rel="stylesheet">
		
		
		<style>
			.modalAdd
			{
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height:100%;
				display:none;
				justify-content: center;
				align-items: center;
				background: rgba(0,0,0,0.5);
				z-index: 1000;
			}		
			
			.modalContent
			{
				background: #fff;
				padding: 20px 30px;
				border-radius: 10px;
				min-width: 300px;
				box-shadow: 0 4px 10px rgba(0,0,0,0.3);
			}
		</style>
		
		
	</head>

	
	<body>
		<th:block th:insert="~{fragments_sidebar::sidebar}"></th:block>
		<div class="content">
			<div class="bg-secondary rounded h-100 p-4">
				<h3 class="mb-4">departments Table INFO</h3>
				<div class="bg-secondary rounded h-100 p-4">
					<table class="table">
						<thead>				
							<tr>
								<th scope = "col">No</th>
								<th scope = "col">dept_no</th>
								<th scope = "col">dept_name</th>
							</tr>
						</thead>	
						
						<tbody>
							<tr th:each="department, stat : ${departments}">
								<td scope = "row" th:text = "${stat.count}"></td>
								<td scope = "row" th:text = "${department.dept_no}"></td>
								<td scope = "row" th:text = "${department.dept_name}"></td>
							</tr>
						</tbody>
					</table>	
				</div>
				
				<button id = "addDepartment" class = "btn btn-success m-2">부서 추가</button>
				<p></p>

				<div style = color:red;>
					<h5 style = color:yellow;>
						[부서 추가 시 중요 사항]
					</h5>
					기존에 있던 부서의 이름과 번호는<br>
					중복 될 수 없습니다!!
				</div>
				
			</div>

			
			<div id= "modalAdd" class = "modalAdd">
				<div class = "modalContent">
					<label>부서 - ID : <input type="text" id ="dept_no"   required="required"></label><br>
					<label>부서 이름 : <input type="text" id ="dept_name" required="required"></label><br>
					
				
					<button id = "submitBtn" class = "btn btn-success m-2">확인</button><br>
				</div>
			</div>
			<!--  이 스코프에 작성 -->
		</div>
		
		
		<!--  제이 쿼리를 쓰다 -->
		<script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js">
		</script>
		
		
		<script>
			const addBtn = $('#addDepartment');
			const submintBtn = $('#submitBtn');
			const modal = $('#modalAdd');
						
			addBtn.on
			('click', function() {
				modal.css("display", "flex");
			});
			
			
			submintBtn.on
			('click', function (event) {
				modal.css("display", "none");
				addDepartment(event);
			});
			
			
			function addDepartment(event)
			{
				event.preventDefault();
				
				let dept_no = $('#dept_no').val();
				let dept_name = $('#dept_name').val();
				
				console.log(`입력한 부서 번호 : ${dept_no}`);
				console.log(`입력한 부서 이름 : ${dept_name}`);
				
				$.ajax
				({
					  type : 'POST'
					, url : '/ajaxInsertDepartment'
					, contentType : 'application/json'
					, data : JSON.stringify({dept_no:dept_no, dept_name:dept_name})
					
					, success : function (result) {
						// ajaxInsertDepartment 요청이 성공했을때
						console.log(result)
						if (result) {
							var table = $('table');
							var row = $('<tr>');
							var cellNo = $('<td>').text(table[0].rows.length);
							var cellID = $('<td>').text(dept_no);
							var cellName = $('<td>').text(dept_name);
							row.append(cellNo, cellID, cellName);
							table.append(row);
							alert(`성공! ${result} 행이 업데이트 되었습니다`);
						}
						else
						{
							alert("오류! : 망해서 삽입되지 않았습니다");
						}
					}
					, error : function () {
						alert("알수 없는 망함");
					}
				})
			}
		</script>
		
		
		
	</body>
</html>